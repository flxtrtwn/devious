name: Deploy

on:
    push:
        branches:
            - main
        paths:
            - tools/devious/pyproject.toml
            - .github/workflows/deploy.yaml

jobs:
    deploy:
        runs-on: ubuntu-latest
        environment:
            name: pypi
        permissions:
            id-token: write
            contents: read

        steps:
            - name: Checkout repo
              uses: actions/checkout@v5
            - name: Install uv
              uses: astral-sh/setup-uv@v6
            - name: Install Python 3.13
              run: uv python install 3.13
            - name: Build
              working-directory: tools/devious
              run: uv build
            - name: Publish
              run: uv publish
